---
title: "Ordination_Analysis_Report_01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.





```{r Ordination}
# First remove all OTUs that do not appear more than five times in half of the samples.

PS2 = phyloseq_obj
PS2_pruned_even = transform_sample_counts(PS2, function(x) 1E6 * x/sum(x))
wh0 = genefilter_sample(PS2_pruned_even, filterfun_sample(function(x) x > 5), A = nsamples(PS2_pruned_even))
PS2_pruned = prune_taxa(wh0, PS2_pruned_even)

PS2_pruned_even = transform_sample_counts(PS2_pruned, function(x) 1E6 * x/sum(x))

phylum.sum = tapply(taxa_sums(PS2_pruned_even), tax_table(PS2_pruned_even)[, "Phylum"], sum, na.rm =TRUE)
top5phyla = names(sort(phylum.sum, TRUE))[1:5]
PS2_Top5 = prune_taxa((tax_table(PS2_pruned_even)[, "Phylum"] %in% top5phyla), PS2_pruned_even)

human = get_variable(PS2, "Organism_s") %in% c("human skin metagenome")
sample_data(PS2)$human <- factor(human)

PS2.ord <- ordinate(PS2, "NMDS", "bray")
p2 = plot_ordination(PS2, PS2.ord, type ="samples", color ="env_feature_s", shape = "human") 
p2 + geom_polygon(aes(fill=SampleType)) + geom_point(size=5) + ggtitle("samples")
```






```{r Ordination}
# First remove all OTUs that do not appear more than five times in half of the samples.

PS2 = phyloseq_obj
PS2_pruned_even = transform_sample_counts(PS2, function(x) 1E6 * x/sum(x))
wh0 = genefilter_sample(PS2_pruned_even, filterfun_sample(function(x) x > 5), A = nsamples(PS2_pruned_even))
PS2_pruned = prune_taxa(wh0, PS2_pruned_even)

PS2_pruned_even = transform_sample_counts(PS2_pruned, function(x) 1E6 * x/sum(x))

phylum.sum = tapply(taxa_sums(PS2_pruned_even), tax_table(PS2_pruned_even)[, "Phylum"], sum, na.rm =TRUE)
top5phyla = names(sort(phylum.sum, TRUE))[1:5]
PS2_Top5 = prune_taxa((tax_table(PS2_pruned_even)[, "Phylum"] %in% top5phyla), PS2_pruned_even)

human = get_variable(PS2, "Organism_s") %in% c("human skin metagenome")
sample_data(PS2)$human <- factor(human)

PS2.ord <- ordinate(PS2, "NMDS", "bray")
p2 = plot_ordination(PS2, PS2.ord, type ="samples", color ="env_feature_s", shape = "human") 
p2 + geom_polygon(aes(fill=SampleType)) + geom_point(size=5) + ggtitle("samples")
```
